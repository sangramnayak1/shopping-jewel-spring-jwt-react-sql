<!doctype html>
<html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Wallet</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head><body>
<div class="container mt-4">
  <h3>Wallet</h3>
  <p>Balance: <span id="balance">-</span></p>
  <input id="topupAmount" class="form-control w-25 d-inline-block" placeholder="Amount">
  <button id="topupBtn" class="btn btn-primary">Top up</button>
</div>
<script>
async function loadWallet(){
  const token = localStorage.getItem('token');
  const res = await fetch('http://localhost:8080/api/wallet', {headers:{'Authorization':'Bearer '+token}});
  if (!res.ok) { alert('Failed'); return; }
  const w = await res.json(); document.getElementById('balance').innerText = '$'+w.balance.toFixed(2);
}
document.getElementById('topupBtn').addEventListener('click', async ()=>{
  const amt = parseFloat(document.getElementById('topupAmount').value);
  const token = localStorage.getItem('token');
  const res = await fetch('http://localhost:8080/api/wallet/topup', {method:'POST', headers:{'Content-Type':'application/json','Authorization':'Bearer '+token}, body:JSON.stringify({amount:amt})});
  if (res.ok){ loadWallet(); alert('Topup success'); } else alert('Topup failed');
});
if (!localStorage.getItem('token')) location='login.html';
loadWallet();
</script>
</body>
</html>
